<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í”¼ë“œ í€´ì¦ˆ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.45/vue.global.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <style>
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 15rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.3s ease-in-out;
        }
        .answer-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fef08a;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-blue-600 text-white p-4">
            <h1 class="text-2xl font-bold text-center">ìŠ¤í”¼ë“œ í€´ì¦ˆ</h1>
        </header>

        <main class="flex-grow container mx-auto p-4">
            <div v-if="!gameStarted" class="text-center">
                <button @click="startGame" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                    ê²Œì„ ì‹œì‘
                </button>
            </div>

            <div v-else class="flex justify-between items-start">
                <div class="text-xl font-bold">ì‹œê°„: {{ timer }}</div>
                <div class="text-xl font-bold">ì ìˆ˜: {{ score }}</div>
            </div>

            <div v-if="gameStarted" class="mt-8">
                <h2 class="text-xl font-bold mb-4">{{ currentQuiz.question }}</h2>
                <div class="flex">
                    <input v-model="userAnswer" @keyup.enter="checkAnswer" type="text" class="flex-grow p-2 border rounded-l" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”">
                    <button @click="checkAnswer" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-r">
                        í™•ì¸
                    </button>
                </div>
            </div>

            <div class="mt-8">
                <h3 class="text-lg font-bold mb-2">í€´ì¦ˆ ë°ì´í„° ì—…ë¡œë“œ</h3>
                <div v-if="!uploadedFile"
                    @dragover.prevent
                    @drop.prevent="onFileDrop"
                    @click="$refs.fileInput.click()"
                    class="border-2 border-dashed border-gray-300 p-4 text-center cursor-pointer"
                >
                    .txt íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”
                    <input type="file" @change="onFileChange" accept=".txt" class="hidden" ref="fileInput">
                </div>
                <div v-else class="border-2 border-gray-300 p-4 text-center">
                    <p>ì—…ë¡œë“œëœ íŒŒì¼: {{ uploadedFile.name }}</p>
                    <button @click="deleteFile" class="mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
                        íŒŒì¼ ì‚­ì œ
                    </button>
                </div>
            </div>

            <!-- ìƒˆë¡œ ì¶”ê°€ëœ ì´ëª¨ì§€ ì˜ì—­ -->
            <div class="text-center mt-8">
                <span class="text-9xl">ğŸ¤“</span>
            </div>
        </main>

        <footer class="bg-gray-200 p-4 text-center">
            <p>&copy; 2024 Runbuild</p>
        </footer>

        <transition name="fade">
            <div v-if="showOverlay" class="result-overlay" :style="{ color: lastAnswerCorrect ? 'green' : 'red', opacity: overlayOpacity }">
                {{ lastAnswerCorrect ? 'â—‹' : 'âœ•' }}
            </div>
        </transition>

        <transition name="fade">
            <div v-if="showAnswerBox" class="answer-box" :style="{ opacity: answerBoxOpacity }">
                ì •ë‹µ: {{ currentQuiz.answer }}
            </div>
        </transition>

        <audio ref="backgroundMusic" loop>
            <source src="https://example.com/kids_background_music.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    defaultQuizData: [
                        { question: "ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„ëŠ”?", answer: "ì„œìš¸" },
                        { question: "1+1=?", answer: "2" },
                        { question: "íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í° í–‰ì„±ì€?", answer: "ëª©ì„±" },
                        { question: "ë¬¼ì˜ í™”í•™ì‹ì€?", answer: "H2O" },
                        { question: "ì„¸ê³„ì—ì„œ ê°€ì¥ ê¸´ ê°•ì€?", answer: "ë‚˜ì¼ê°•" },
                        { question: "ì¸ë¥˜ ìµœì´ˆë¡œ ë‹¬ì— ì°©ë¥™í•œ ì‚¬ëŒì€?", answer: "ë‹ ì•”ìŠ¤íŠ¸ë¡±" },
                        { question: "ì…°ìµìŠ¤í”¼ì–´ì˜ ëŒ€í‘œì‘ ì¤‘ í•˜ë‚˜ëŠ”?", answer: "í–„ë¦¿" },
                        { question: "DNAì˜ ì™„ì „í•œ ì´ë¦„ì€?", answer: "ë””ì˜¥ì‹œë¦¬ë³´í•µì‚°" },
                        { question: "ë¹›ì˜ ì†ë„ëŠ”? (ìˆ«ìë§Œ)", answer: "299792458" },
                        { question: "ì§€êµ¬ì—ì„œ ê°€ì¥ ë†’ì€ ì‚°ì€?", answer: "ì—ë² ë ˆìŠ¤íŠ¸" },
                        { question: "í”¼ì¹´ì†Œì˜ ëŒ€í‘œì ì¸ í™”í’ì€?", answer: "ì…ì²´ì£¼ì˜" },
                        { question: "ì›ì£¼ìœ¨(Ï€)ì˜ ì²˜ìŒ ì„¸ ìë¦¬ëŠ”?", answer: "3.14" },
                        { question: "ì¸ê°„ì˜ ì‹¬ì¥ì€ ëª‡ ê°œì˜ ë°©ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‚˜?", answer: "4" }
                    ],
                    quizData: [],
                    currentQuiz: {},
                    userAnswer: "",
                    score: 0,
                    timer: 60,
                    gameStarted: false,
                    intervalId: null,
                    uploadedFile: null,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    wrongAnswers: 0,
                    lastAnswerCorrect: null,
                    showOverlay: false,
                    overlayOpacity: 0,
                    usedQuestions: new Set(),
                    isProcessing: false,
                    showAnswerBox: false,
                    answerBoxOpacity: 0
                }
            },
            created() {
                this.quizData = [...this.defaultQuizData];
            },
            methods: {
                startGame() {
                    this.gameStarted = true;
                    this.score = 0;
                    this.timer = 60;
                    this.totalQuestions = 0;
                    this.correctAnswers = 0;
                    this.wrongAnswers = 0;
                    this.usedQuestions.clear();
                    this.nextQuiz();
                    this.intervalId = setInterval(() => {
                        this.timer--;
                        if (this.timer <= 0) this.endGame();
                    }, 1000);
                    this.$refs.backgroundMusic.play();
                },
                nextQuiz() {
                    this.isProcessing = false;
                    this.showOverlay = false;
                    this.overlayOpacity = 0;
                    this.lastAnswerCorrect = null;
                    this.showAnswerBox = false;
                    this.answerBoxOpacity = 0;
                    
                    const availableQuizzes = this.quizData.filter(quiz => !this.usedQuestions.has(quiz.question));
                    if (availableQuizzes.length === 0) {
                        this.usedQuestions.clear();
                        availableQuizzes.push(...this.quizData);
                    }
                    const randomIndex = Math.floor(Math.random() * availableQuizzes.length);
                    this.currentQuiz = availableQuizzes[randomIndex];
                    this.usedQuestions.add(this.currentQuiz.question);
                    this.userAnswer = "";
                },
                checkAnswer() {
                    if (this.isProcessing) return;
                    this.isProcessing = true;

                    this.totalQuestions++;
                    const isCorrect = this.userAnswer.toLowerCase() === this.currentQuiz.answer.toLowerCase();
                    if (isCorrect) {
                        this.score++;
                        this.correctAnswers++;
                    } else {
                        this.wrongAnswers++;
                        this.showAnswerBox = true;
                        this.answerBoxOpacity = 1;
                    }
                    this.showResultOverlay(isCorrect);
                },
                showResultOverlay(isCorrect) {
                    this.lastAnswerCorrect = isCorrect;
                    this.showOverlay = true;
                    this.overlayOpacity = 1;

                    setTimeout(() => {
                        this.overlayOpacity = 0;
                        if (this.showAnswerBox) {
                            this.answerBoxOpacity = 0;
                        }
                        setTimeout(() => {
                            this.showOverlay = false;
                            this.showAnswerBox = false;
                            this.nextQuiz();
                        }, 300); // í˜ì´ë“œ ì•„ì›ƒ ì‹œê°„
                    }, 1500); // ì˜¤ë²„ë ˆì´ì™€ ì •ë‹µ ë°•ìŠ¤ í‘œì‹œ ì‹œê°„
                },
                endGame() {
                    clearInterval(this.intervalId);
                    this.gameStarted = false;
                    const accuracyRate = this.totalQuestions > 0 ? (this.correctAnswers / this.totalQuestions * 100).toFixed(2) : 0;
                    swal({
                        title: "ê²Œì„ ì¢…ë£Œ!",
                        text: `ì´ ë¬¸ì œ ìˆ˜: ${this.totalQuestions}\nì •ë‹µ ê°œìˆ˜: ${this.correctAnswers}\ní‹€ë¦° ê°œìˆ˜: ${this.wrongAnswers}\nì •ë‹µë¥ : ${accuracyRate}%`,
                        icon: "info",
                        button: "ë‹¤ì‹œ í”Œë ˆì´",
                    });
                    this.$refs.backgroundMusic.pause();
                    this.$refs.backgroundMusic.currentTime = 0;
                },
                onFileDrop(e) {
                    const file = e.dataTransfer.files[0];
                    this.handleFile(file);
                },
                onFileChange(e) {
                    const file = e.target.files[0];
                    this.handleFile(file);
                },
                handleFile(file) {
                    if (file.type !== "text/plain") {
                        swal("ì˜¤ë¥˜", ".txt íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤", "error");
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        this.parseQuizData(content);
                    };
                    reader.readAsText(file);
                    this.uploadedFile = file;
                },
                parseQuizData(content) {
                    const lines = content.split('\n');
                    const newQuizData = lines.map(line => {
                        const [question, answer] = line.split(':').map(item => item.trim());
                        return { question, answer };
                    }).filter(item => item.question && item.answer);

                    if (newQuizData.length > 0) {
                        this.quizData = newQuizData;
                        this.usedQuestions.clear();
                        swal("ì„±ê³µ", `${newQuizData.length}ê°œì˜ í€´ì¦ˆ ë¬¸ì œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤`, "success");
                    } else {
                        swal("ì˜¤ë¥˜", "íŒŒì¼ì—ì„œ ìœ íš¨í•œ í€´ì¦ˆ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤", "error");
                    }
                },
                deleteFile() {
                    this.uploadedFile = null;
                    this.$refs.fileInput.value = '';
                    this.quizData = [...this.defaultQuizData];
                    this.usedQuestions.clear();
                    swal("ì•Œë¦¼", "ê¸°ë³¸ í€´ì¦ˆ ë°ì´í„°ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤", "info");
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
